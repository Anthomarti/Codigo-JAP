<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Código JAP - Anthomarti</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #121212; color: #eee; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    a { color: #58a6ff; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .container { max-width: 880px; margin-top: 48px; }
    .folder { padding: 10px 0; border-bottom: 1px solid #2b2b2b; display: flex; justify-content: space-between; gap: 12px; }
    .muted { color: #9aa0a6; font-size: .9rem; }
    .loading { text-align: center; margin-top: 2rem; font-style: italic; color: #9aa0a6; }
    .badge-ok{ background:#198754; }
    .badge-miss{ background:#6c757d; }
    .small-err{ font-size:.9rem; color:#ffb4b4 }
    code { color:#ffc107 }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="mb-2 text-center">Repositorio: <span class="text-info">Código JAP</span></h1>
    <p class="text-center muted">
      Lista auto-generada con enlaces a <b>index.html</b> de cada carpeta.
    </p>

    <div id="fileList" class="mt-4"></div>
    <div id="loading" class="loading">Cargando lista de carpetas…</div>

    <div class="mt-4 muted">
      <details>
        <summary>¿Error de API / repo privado? Opcional: usar token</summary>
        <p class="mt-2">
          Podés pasar un token personal de GitHub en la URL como <code>?token=ghp_xxx</code>
          (solo lectura). Ayuda si el repo es privado o si superaste el límite anónimo (60 req/h).
        </p>
      </details>
    </div>
  </div>

  <script>
    // ===== config =====
    const username = "Anthomarti";
    const repo     = "Codigo-JAP";
    const branch   = "main"; // poné "master" si tu rama por defecto es master

    // jsDelivr data API: devuelve el árbol de archivos
    // https://data.jsdelivr.com/v1/package/gh/:user/:repo@:version
    const DATA_URL = `https://data.jsdelivr.com/v1/package/gh/${username}/${repo}@${branch}`;

    const container = document.getElementById("fileList");
    const loading   = document.getElementById("loading");

    // Recorre recursivamente el árbol de jsDelivr para obtener directorios de nivel 1
    function flattenDirs(files, base = "") {
      const out = [];
      for (const f of files) {
        const path = base ? `${base}/${f.name}` : f.name;
        if (f.type === "directory") {
          out.push({ name: f.name, path, files: f.files || [] });
        }
      }
      return out;
    }

    function dirHasIndexHtml(dir) {
      // busca index.html en ese directorio (solo nivel directo)
      return (dir.files || []).some(x => x.type === "file" && x.name === "index.html");
    }

    async function generateList() {
      try {
        const res = await fetch(DATA_URL, { cache: "no-store" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json(); // { files: [...] }

        const level1Dirs = flattenDirs(data.files || []);

        if (!level1Dirs.length) {
          container.innerHTML = "<p class='text-secondary'>No hay carpetas en el repositorio.</p>";
          return;
        }

        const ul = document.createElement("ul");
        ul.className = "list-unstyled";

        level1Dirs.forEach(dir => {
          const li = document.createElement("li");
          li.className = "folder";
          if (dirHasIndexHtml(dir)) {
            li.innerHTML = `
              <span><a href="./${encodeURIComponent(dir.name)}/index.html" target="_blank">${dir.name}</a></span>
              <span class="badge bg-success">index.html</span>`;
          } else {
            li.innerHTML = `
              <span>${dir.name}</span>
              <span class="badge bg-secondary">sin index.html</span>`;
          }
          ul.appendChild(li);
        });

        container.innerHTML = "";
        container.appendChild(ul);
      } catch (e) {
        container.innerHTML = `
          <p class="text-danger">Error al obtener contenido (jsDelivr): <code>${e.message}</code></p>
          <p class="text-secondary mb-0">Si persiste, probá la Opción A (token) o verificá rama <b>${branch}</b>.</p>`;
      } finally {
        loading?.remove();
      }
    }

    generateList();
  </script>

</body>
</html>
